{"version":3,"file":"billsPay.js","sourceRoot":"","sources":["../../src/scripts/billsPay.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * Summary: Sends a request to pay for a users bill\n */\nfunction payBill() {\n    const billYear = document.getElementById(\"billYear\")!.innerHTML;\n    const billMonth = document.getElementById(\"billMonth\")!.innerHTML;\n    const groupId = document.getElementById(\"groupId\")!.innerHTML;\n    const userId = (document.getElementById(\"userId\") as HTMLInputElement)!.value;\n    const billData = {\n        group: groupId,\n        month: billMonth,\n        user: userId,\n        year: billYear,\n    };\n    $.ajax({\n        data: billData,\n        error: (xhr, ajaxOptions, thrownError) => {\n            alert(xhr.status);\n            alert(thrownError);\n        },\n        success: (result) => {\n            $(\"#message\").html(\"\");\n            $(\"#message\").append(result.status);\n            document.location.reload();\n        },\n        type: \"POST\",\n        url: \"/bill/pay\",\n    });\n}\n\nfunction setGroupId(groupName: any, groupId: any, year: any, month: any) {\n    $(\"#groupName\").html(groupName);\n    $(\"#groupId\").html(groupId);\n    $(\"#billYear\").html(year);\n    month = +month - 1;\n    if ( month === -1) {\n        month = 11;\n    }\n    $(\"#billMonth\").html(String(month));\n}\n\nfunction getNetVals(netVals: any, purchases: any, user: any) {\n    for (const purch of purchases) {\n        $.ajax({\n            async: false,\n            data: {\n                allPurchases: purch,\n                userInfo: user,\n            },\n            error: (xhr, ajaxOptions, thrownError) => {\n                alert(xhr.status);\n                alert(thrownError);\n            },\n            success: (result) => {\n                const purchDate = new Date(purch.date);\n                const month = purchDate.getMonth();\n                const year = purchDate.getFullYear();\n                const paidList = result[year][month];\n                if (paidList && paidList.indexOf(user) > -1) {\n                    return;\n                }\n                if (!netVals[year]) {\n                    netVals[year] = {};\n                }\n                if (!netVals[year][month]) {\n                    netVals[year][month] = {};\n                }\n                if (!(netVals[year][month][purch.Group.Name])) {\n                    netVals[year][month][purch.Group.Name] = {\n                        id: purch.Group._id,\n                        price: -purch.item.Price,\n                    };\n                } else {\n                    netVals[year][month][purch.Group.Name].price -= purch.item.Price;\n                }\n            },\n            type: \"GET\",\n            url: \"/bill/paid\",\n        });\n    }\n    return netVals;\n}\n\n/**\n * Summary: gets the net amount a user owes to each group\n * @param purchases\n * @param userId\n */\nfunction listCurrentGroupNet(purchases: any, userId: any) {\n    // Need to add additional filter for date, return an array of \"nets\" grouped by month\n    let netVals: any = {};\n    netVals = getNetVals(netVals, purchases.payee, userId);\n    netVals = getNetVals(netVals, purchases.payer, userId);\n\n    displayCurrentNetValues(netVals);\n}\n\nfunction displayCurrentNetValues(nets: any) {\n    const monthDictionary = [\"January\", \"February\", \"March\", \"April\", \"May\", \"June\", \"July\", \"August\", \"September\", \"October\", \"November\", \"December\"];\n    for (const year in nets) {\n        if (nets.hasOwnProperty(year)) {\n            for (const month in nets[year]) {\n                if (nets[year].hasOwnProperty(month)) {\n                    for (const key in nets[year][month]) {\n                        if (nets[year][month].hasOwnProperty(key)) {\n                            const amount = Math.round(100 * nets[year][month][key].price) / 100;\n                            if (amount <= 0) {\n                                continue;\n                            }\n                            const id = nets[year][month][key].id;\n                            const item = document.createElement(\"a\");\n                            const yearKey = +year;\n                            let monthKey = +month;\n                            if (monthKey === 12) {\n                                monthKey = 0;\n                            }\n                            $(item).attr(\"class\", \"list-group-item\");\n                            $(item).attr(\"id\", \"listItem\");\n                            if (amount > 0) {\n                                $(item).html(\n                                    \"<div class='row'>\" +\n                                    \"<div class='col col-left'>\" +\n                                    \"<p>\" + key + \"</p>\" +\n                                    \"</div>\" +\n                                    \"<div class='col col-right'>\" +\n                                    \"<p>$ \" + amount.toFixed(2) + \"</p>\" +\n                                    \"</div>\" +\n                                    \"</div>\" +\n                                    \"<div class='row sub-row'>\" +\n                                    \"<div class='col col-left'>\" +\n                                    \"<p>\" + \"Due \" + monthDictionary[monthKey] + \" 1 \" + yearKey + \"</p>\" +\n                                    \"</div>\" +\n                                    \"<div class='col col-right'>\" +\n                                    \"<button type='button' class='btn btn-primary btn-small' data-toggle='modal' data-target=\\\"#createFormDiv\\\" id=\" + id + \" onClick='setGroupId(\" + \"\\\"\" + key + \"\\\", \" + \"\\\"\" + id + \"\\\", \" + \"\\\"\" + yearKey + \"\\\", \" + \"\\\"\" + monthKey + \"\\\"\" + \")'>Pay</button>\" +\n                                    \"</div>\" +\n                                    \"</div>\");\n                            } else {\n                                $(item).html(\n                                    \"<div class='row'>\" +\n                                    \"<div class='col col-left'>\" +\n                                    \"<p>\" + key + \"</p>\" +\n                                    \"</div>\" +\n                                    \"<div class='col col-right'>\" +\n                                    \"<p>$ \" + amount.toFixed(2) + \"</p>\" +\n                                    \"</div>\" +\n                                    \"</div>\" +\n                                    \"<div class='row sub-row'>\" +\n                                    \"<div class='col col-left'>\" +\n                                    \"<p>\" + \"Due \" + monthDictionary[monthKey] + \" 1 \" + yearKey + \"</p>\" +\n                                    \"</div>\" +\n                                    \"<div class='col col-right'>\" +\n                                    \"<button type='button' class='btn btn-secondary btn-small' disabled>Paid</button>\" +\n                                    \"</div>\" +\n                                    \"</div>\");\n                            }\n                            $(\"#billStatus\").append(item);\n                        }\n                    }\n                }\n            }\n        }\n    }\n}\n\nfunction getCurrentUserBills() {\n    if (document.getElementById(\"userId\")) {\n        const userId = (document.getElementById(\"userId\") as HTMLInputElement).value;\n        $.ajax({\n            data: $(\"#userId\").serialize(),\n            error: (xhr, ajaxOptions, thrownError) => {\n                alert(xhr.status);\n                alert(thrownError);\n            },\n            success: (result) => {\n                listCurrentGroupNet(result, userId);\n                return true;\n            },\n            type: \"GET\",\n            url: \"/user/bills/purchases\",\n        });\n    }\n}\n\ndocument.addEventListener(\"DOMContentLoaded\", () => {\n    getCurrentUserBills();\n});\n"]}